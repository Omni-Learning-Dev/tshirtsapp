import{D as oe}from"./Default-BGHjruH1.js";import{p as W,a7 as X,q as M,g as L,d as $,b as t,F as E,m as S,S as re,s as J,N as v,L as ne,W as ie,ac as de,k as ue,o as O,c as ce,w as o,i as y,a,t as h,f as H,j as me,l as fe}from"./app-Cl41KS6a.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{m as he,a as P,c as be,b as pe,V as ve,d as ye}from"./VMain-CATYbn2w.js";import{V as Ve}from"./VSpacer-BOCDp28J.js";import{V as _e,a as R}from"./VRow-QLC2tL2Y.js";import{c as I,a as B}from"./VCard-Csc-1wQW.js";import{V as xe}from"./VTable-Dg6ZFnmt.js";import{n as we,u as F,d as ke,h as Pe,o as Se,l as Ce,a as Te}from"./index-DsaZ1FWs.js";import{f as Ie}from"./forwardRefs-C-GTDzx5.js";import{a as Be,s as $e}from"./easing-DY7PVvcf.js";import{m as We,V as G,a as Me,b as Q}from"./VWindowItem-CEH8bNM7.js";import{m as Fe,V as Y}from"./VSlideGroup-ojcg22wy.js";import{u as Ue,a as De,V as Oe}from"./VOverlay-DX-OpVhQ.js";import{V as qe}from"./VForm-BQE95a4T.js";import{V as ze}from"./VTextField-hiLECZOE.js";import"./VAvatar-DVztq09M.js";import"./lazy-BxG18cbM.js";import"./form-jy44j9mz.js";const N=Symbol.for("vuetify:v-tabs"),Ee=W({fixed:Boolean,sliderColor:String,hideSlider:Boolean,direction:{type:String,default:"horizontal"},...X(he({selectedClass:"v-tab--selected",variant:"text"}),["active","block","flat","location","position","symbol"])},"VTab"),q=M()({name:"VTab",props:Ee(),setup(e,s){let{slots:d,attrs:l}=s;const{textColorClasses:r,textColorStyles:m}=we(e,"sliderColor"),u=L(),n=L(),f=$(()=>e.direction==="horizontal"),V=$(()=>{var b,i;return((i=(b=u.value)==null?void 0:b.group)==null?void 0:i.isSelected.value)??!1});function U(b){var c,p;let{value:i}=b;if(i){const g=(p=(c=u.value)==null?void 0:c.$el.parentElement)==null?void 0:p.querySelector(".v-tab--selected .v-tab__slider"),D=n.value;if(!g||!D)return;const Z=getComputedStyle(g).color,_=g.getBoundingClientRect(),x=D.getBoundingClientRect(),C=f.value?"x":"y",T=f.value?"X":"Y",j=f.value?"right":"bottom",w=f.value?"width":"height",ee=_[C],te=x[C],k=ee>te?_[j]-x[j]:_[C]-x[C],ae=Math.sign(k)>0?f.value?"right":"bottom":Math.sign(k)<0?f.value?"left":"top":"center",se=(Math.abs(k)+(Math.sign(k)<0?_[w]:x[w]))/Math.max(_[w],x[w])||0,le=_[w]/x[w]||0,A=1.5;Be(D,{backgroundColor:[Z,"currentcolor"],transform:[`translate${T}(${k}px) scale${T}(${le})`,`translate${T}(${k/A}px) scale${T}(${(se-1)/A+1})`,"none"],transformOrigin:Array(3).fill(ae)},{duration:225,easing:$e})}}return F(()=>{const b=P.filterProps(e);return t(P,S({symbol:N,ref:u,class:["v-tab",e.class],style:e.style,tabindex:V.value?0:-1,role:"tab","aria-selected":String(V.value),active:!1},b,l,{block:e.fixed,maxWidth:e.fixed?300:void 0,"onGroup:selected":U}),{...d,default:()=>{var i;return t(E,null,[((i=d.default)==null?void 0:i.call(d))??e.text,!e.hideSlider&&t("div",{ref:n,class:["v-tab__slider",r.value],style:m.value},null)])}})}),Ie({},u)}}),Ne=W({...X(We(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VTabsWindow"),K=M()({name:"VTabsWindow",props:Ne(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:d}=s;const l=re(N,null),r=J(e,"modelValue"),m=$({get(){var u;return r.value!=null||!l?r.value:(u=l.items.value.find(n=>l.selected.value.includes(n.id)))==null?void 0:u.value},set(u){r.value=u}});return F(()=>{const u=G.filterProps(e);return t(G,S({_as:"VTabsWindow"},u,{modelValue:m.value,"onUpdate:modelValue":n=>m.value=n,class:["v-tabs-window",e.class],style:e.style,mandatory:!1,touch:!1}),d)}),{}}}),je=W({...Me()},"VTabsWindowItem"),z=M()({name:"VTabsWindowItem",props:je(),setup(e,s){let{slots:d}=s;return F(()=>{const l=Q.filterProps(e);return t(Q,S({_as:"VTabsWindowItem"},l,{class:["v-tabs-window-item",e.class],style:e.style}),d)}),{}}});function Ae(e){return e?e.map(s=>de(s)?s:{text:s,value:s}):[]}const Le=W({alignTabs:{type:String,default:"start"},color:String,fixedTabs:Boolean,items:{type:Array,default:()=>[]},stacked:Boolean,bgColor:String,grow:Boolean,height:{type:[Number,String],default:void 0},hideSlider:Boolean,sliderColor:String,...Fe({mandatory:"force",selectedClass:"v-tab-item--selected"}),...ke(),...Pe()},"VTabs"),He=M()({name:"VTabs",props:Le(),emits:{"update:modelValue":e=>!0},setup(e,s){let{attrs:d,slots:l}=s;const r=J(e,"modelValue"),m=$(()=>Ae(e.items)),{densityClasses:u}=Se(e),{backgroundColorClasses:n,backgroundColorStyles:f}=Ce(v(e,"bgColor")),{scopeId:V}=Ue();return ne({VTab:{color:v(e,"color"),direction:v(e,"direction"),stacked:v(e,"stacked"),fixed:v(e,"fixedTabs"),sliderColor:v(e,"sliderColor"),hideSlider:v(e,"hideSlider")}}),F(()=>{const U=Y.filterProps(e),b=!!(l.window||e.items.length>0);return t(E,null,[t(Y,S(U,{modelValue:r.value,"onUpdate:modelValue":i=>r.value=i,class:["v-tabs",`v-tabs--${e.direction}`,`v-tabs--align-tabs-${e.alignTabs}`,{"v-tabs--fixed-tabs":e.fixedTabs,"v-tabs--grow":e.grow,"v-tabs--stacked":e.stacked},u.value,n.value,e.class],style:[{"--v-tabs-height":ie(e.height)},f.value,e.style],role:"tablist",symbol:N},V,d),{default:()=>{var i;return[((i=l.default)==null?void 0:i.call(l))??m.value.map(c=>{var p;return((p=l.tab)==null?void 0:p.call(l,{item:c}))??t(q,S(c,{key:c.text,value:c.value}),{default:l[`tab.${c.value}`]?()=>{var g;return(g=l[`tab.${c.value}`])==null?void 0:g.call(l,{item:c})}:void 0})})]}}),b&&t(K,S({modelValue:r.value,"onUpdate:modelValue":i=>r.value=i,key:"tabs-window"},V),{default:()=>{var i;return[m.value.map(c=>{var p;return((p=l.item)==null?void 0:p.call(l,{item:c}))??t(z,{value:c.value},{default:()=>{var g;return(g=l[`item.${c.value}`])==null?void 0:g.call(l,{item:c})}})}),(i=l.window)==null?void 0:i.call(l)]}})])}),{}}}),Re={layout:oe,data(){return{tab:null,form:this.$inertia.form({amount:null,order_id:this.$page.props.order.id,client_id:this.$page.props.order.client_id,customerPhoneNumber:"0771049950",reason:"payment for order no "+this.$page.props.order.id}),btnloading:!1,valid:!0,loading:!1,loaderMessage:"",retries:10,rules:{customerPhoneNumber:[e=>!!e||"Phone is required",e=>(e?e.length===10:!1)||"Phone number must have 10 characters",e=>/07[1,8,7]\d{7}/.test(e)||"Please enter a valid Econet or OneMoney number"]}}},computed:{totalQuantities(){return this.$page.props.order.quantities.reduce((e,s)=>e+s.quantity,0)},totalUSD(){return this.$page.props.order.quantities.reduce((e,s)=>(this.form.amount=e+this.getPriceForSize(s.size,s.gender,"usd")*s.quantity,e+this.getPriceForSize(s.size,s.gender,"usd")*s.quantity),0)}},methods:{getPriceForSize(e,s,d="usd"){const l=this.$page.props.prices.find(r=>r.size===e&&r.gender===s);return l?d==="usd"?l.usd_price:l.rtgs_price:0},async MakePayment(){if(this.form.customerPhoneNumber.length<10)return;this.btnloading=!0;const e=(await axios.post(route("initiatePayment"),this.form)).data;if(e.status==="error"){this.$swal.fire({icon:"error",title:e.message,text:e.reason});return}this.loaderMessage=e.message,this.loading=!0,this.btnloading=!0,console.log(e);var s=new FormData;s.append("ref_num",e.ref_num),this.callbackHandler=setInterval(async()=>{const d=(await axios.post(route("pese-return"),s)).data;if(d.status==="paid")return this.markAsPaid(d.ref_num);if(this.retries<=1)return this.markAsFailed();this.retries--},2e3),this.btnloading=!1},markAsFailed(){this.removeCallback(),this.removeOverlay(),this.$swal.fire({icon:"info",text:"Transaction timed out while waiting for payment."})},markAsPaid(e){this.removeCallback(),this.removeOverlay(),this.$swal.fire({icon:"success",title:"Payment Successful",text:"We have successfully received your payment!. Please save this reference no. "+e}),window.location=route("pese-result",e)},removeCallback(){clearInterval(this.callbackHandler)},removeOverlay(){this.loading=!1},removeSize(e){this.$inertia.delete(route("order.removeSize",{order:this.$page.props.order.id,index:e}),{onSuccess:()=>{this.$toast.success("Size removed successfully!")},onError:()=>{this.$toast.error("Failed to remove size.")}})}}},Ge=a("thead",null,[a("tr",null,[a("th",{class:"text-left"},"Size"),a("th",{class:"text-left"},"Gender"),a("th",{class:"text-left"},"Unit price"),a("th",{class:"text-left"},"Quantity"),a("th",{class:"text-left"},"USD Price"),a("th",{class:"text-left"},"Options")])],-1),Qe=a("td",null,[a("strong",null,"Totals")],-1),Ye=a("td",null,[a("strong")],-1),Xe=a("td",null,null,-1),Je=a("img",{class:"mx-1",src:"/icons/ecocash.jpg",height:"28",alt:""},null,-1),Ke=a("img",{class:"mx-1",src:"/icons/onemoney.png",height:"28",alt:""},null,-1),Ze=a("img",{class:"mx-3",src:"/icons/innbucks.jpg",height:"40",alt:""},null,-1),et=a("img",{class:"mx-3",src:"/icons/visa.jpg",height:"28",alt:""},null,-1),tt=a("h1",null,"Payment Details",-1),at=a("br",null,null,-1),st=a("h1",{class:"mb-3 mx-5 text-accent"},"Make payment externally",-1),lt=a("div",{class:"d-flex pa-3"},[a("img",{class:"mx-3",src:"/icons/ecocash.jpg",height:"30",alt:""}),a("img",{class:"mx-3",src:"/icons/onemoney.png",height:"30",alt:""}),a("img",{class:"mx-3",src:"/icons/innbucks.jpg",height:"30",alt:""}),a("img",{class:"mx-3",src:"/icons/visa.jpg",height:"30",alt:""})],-1),ot={class:"text-center"},rt=["innerHTML"];function nt(e,s,d,l,r,m){const u=ue("InertiaLink");return O(),ce(be,{class:"mt-5",fluid:""},{default:o(()=>[t(I,{class:"glass pa-5"},{default:o(()=>[t(pe,{class:"mb-5 rounded-lg"},{default:o(()=>[t(ve,null,{default:o(()=>[y(" Order ")]),_:1}),t(Ve),t(P,{variant:"flat",class:"mr-3",href:"/order/order-add-client/"+e.$page.props.order.id},{default:o(()=>[y(" Back ")]),_:1},8,["href"])]),_:1}),t(_e,null,{default:o(()=>[t(R,{cols:"12",sm:"6"},{default:o(()=>[t(I,null,{default:o(()=>[t(B,null,{default:o(()=>[a("h1",null,"Summary | Order for "+h(e.$page.props.category.name)+"(s)",1),t(xe,null,{default:o(()=>[Ge,a("tbody",null,[(O(!0),H(E,null,me(e.$page.props.order.quantities,(n,f)=>(O(),H("tr",{key:f},[a("td",null,h(n.size),1),a("td",null,h(n.gender),1),a("td",null,"$ "+h(m.getPriceForSize(n.size,n.gender,"usd")),1),a("td",null,h(n.quantity),1),a("td",null,"$ "+h(m.getPriceForSize(n.size,n.gender,"usd")*n.quantity),1),a("td",null,[t(P,{color:"error",onClick:V=>m.removeSize(n.id)},{default:o(()=>[t(Te,null,{default:o(()=>[y("mdi-trash-can")]),_:1})]),_:2},1032,["onClick"])])]))),128)),a("tr",null,[Qe,Ye,a("td",null,[a("strong",null,h(m.totalQuantities)+" Items",1)]),a("td",null,[a("strong",null,"$ "+h(m.totalUSD.toFixed(2)),1)]),Xe])])]),_:1})]),_:1})]),_:1})]),_:1}),t(R,{cols:"12",sm:"6"},{default:o(()=>[t(I,null,{default:o(()=>[t(He,{grow:"",modelValue:r.tab,"onUpdate:modelValue":s[0]||(s[0]=n=>r.tab=n)},{default:o(()=>[t(q,{value:"express"},{default:o(()=>[y(" Express Checkout "),Je,Ke]),_:1}),t(q,{value:"pesepay"},{default:o(()=>[Ze,et]),_:1})]),_:1},8,["modelValue"]),t(De),t(K,{modelValue:r.tab,"onUpdate:modelValue":s[3]||(s[3]=n=>r.tab=n)},{default:o(()=>[t(z,{value:"express"},{default:o(()=>[t(qe,{modelValue:r.valid,"onUpdate:modelValue":s[2]||(s[2]=n=>r.valid=n),onSubmit:fe(m.MakePayment,["prevent"])},{default:o(()=>[t(B,null,{default:o(()=>[tt,t(ze,{class:"mt-5",label:"Your phone number",modelValue:r.form.customerPhoneNumber,"onUpdate:modelValue":s[1]||(s[1]=n=>r.form.customerPhoneNumber=n),rules:r.rules.customerPhoneNumber},null,8,["modelValue","rules"]),t(P,{loading:r.btnloading,disabled:!r.valid,block:"",class:"mt-5",type:"submit"},{default:o(()=>[y(" Pay Order ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1}),t(z,{value:"pesepay"},{default:o(()=>[at,st,lt,t(B,null,{default:o(()=>[t(u,{class:"InertiaLink",href:e.route("pesePayCheckout",{order:e.$page.props.order.id})},{default:o(()=>[t(P,{color:"success",block:"",size:"x-large"},{default:o(()=>[y(" Checkout with PesePay ")]),_:1})]),_:1},8,["href"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a("div",null,[t(Oe,{class:"border d-flex align-center justify-center",modelValue:r.loading,"onUpdate:modelValue":s[4]||(s[4]=n=>r.loading=n)},{default:o(()=>[t(I,{variant:"flat",width:"500"},{default:o(()=>[t(B,null,{default:o(()=>[a("div",ot,[a("p",{innerHTML:r.loaderMessage},null,8,rt),t(ye,{color:"primary",indeterminate:"",size:"64"},{default:o(()=>[y(h(r.retries),1)]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})}const Tt=ge(Re,[["render",nt]]);export{Tt as default};
